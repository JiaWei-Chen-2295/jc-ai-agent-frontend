{"openapi":"3.0.1","info":{"title":"OpenAPI definition","version":"v0"},"servers":[{"url":"http://localhost:8525/api","description":"Generated server url"}],"tags":[{"name":"文档管理","description":"文档上传与索引管理接口"},{"name":"团队管理","description":"团队（租户）创建、加入、退出与切换"},{"name":"学习伙伴聊天","description":"基于向量检索的 AI 学习助手对话接口（支持轮询与 SSE）"},{"name":"健康检查","description":"基础探活接口"},{"name":"用户管理","description":"用户管理与认证接口"}],"paths":{"/user/update":{"post":{"tags":["用户管理"],"summary":"更新用户（管理员）","operationId":"updateUser","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserUpdateRequest"}}},"required":true},"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/BaseResponseBoolean"}}}}}}},"/user/update/my":{"post":{"tags":["用户管理"],"summary":"更新我的资料","operationId":"updateMyUser","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserUpdateMyRequest"}}},"required":true},"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/BaseResponseUserVO"}}}}}}},"/user/register":{"post":{"tags":["用户管理"],"summary":"用户注册","operationId":"userRegister","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserRegisterRequest"}}},"required":true},"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/BaseResponseLong"}}}}}}},"/user/logout":{"post":{"tags":["用户管理"],"summary":"用户退出登录","operationId":"userLogout","responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/BaseResponseBoolean"}}}}}}},"/user/login":{"post":{"tags":["用户管理"],"summary":"用户登录","operationId":"userLogin","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserLoginRequest"}}},"required":true},"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/BaseResponseUserVO"}}}}}}},"/user/list/page":{"post":{"tags":["用户管理"],"summary":"分页查询用户（管理员）","operationId":"listUserByPage","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserQueryRequest"}}},"required":true},"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/BaseResponsePageUserVO"}}}}}}},"/user/delete":{"post":{"tags":["用户管理"],"summary":"删除用户（管理员）","operationId":"deleteUser","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/DeleteRequest"}}},"required":true},"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/BaseResponseBoolean"}}}}}}},"/user/add":{"post":{"tags":["用户管理"],"summary":"新增用户（管理员）","operationId":"addUser","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserCreateRequest"}}},"required":true},"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/BaseResponseLong"}}}}}}},"/tenant/transfer-admin":{"post":{"tags":["团队管理"],"summary":"管理员转让","operationId":"transferAdmin","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/TenantTransferAdminRequest"}}},"required":true},"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/BaseResponseBoolean"}}}}}}},"/tenant/leave":{"post":{"tags":["团队管理"],"summary":"退出团队","operationId":"leaveTenant","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/TenantLeaveRequest"}}},"required":true},"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/BaseResponseBoolean"}}}}}}},"/tenant/join":{"post":{"tags":["团队管理"],"summary":"加入团队","operationId":"joinTenant","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/TenantJoinRequest"}}},"required":true},"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/BaseResponseBoolean"}}}}}}},"/tenant/create":{"post":{"tags":["团队管理"],"summary":"创建团队","operationId":"createTeam","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/TenantCreateRequest"}}},"required":true},"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/BaseResponseTenantVO"}}}}}}},"/tenant/active":{"post":{"tags":["团队管理"],"summary":"切换当前团队","operationId":"setActiveTenant","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/TenantSetActiveRequest"}}},"required":true},"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/BaseResponseBoolean"}}}}}}},"/api/document/{documentId}/reindex":{"post":{"tags":["文档管理"],"summary":"重新索引文档","description":"重新执行文档的向量化处理（用于失败重试）","operationId":"reindexDocument","parameters":[{"name":"documentId","in":"path","description":"文档唯一标识 ID","required":true,"schema":{"type":"integer","format":"int64"},"example":1001}],"responses":{"200":{"description":"提交成功","content":{"application/json":{"example":{"code":0,"data":"重新索引任务已提交","message":"ok"}}}}}}},"/api/document/upload":{"post":{"tags":["文档管理"],"summary":"上传文档","description":"上传文档后立即返回，后台异步进行向量化处理。返回的 documentId 可用于查询状态。","operationId":"uploadDocument","requestBody":{"content":{"multipart/form-data":{"schema":{"required":["file"],"type":"object","properties":{"file":{"type":"string","description":"上传的文档文件，支持 pdf/pptx/docx/md 等","format":"binary"}}}}}},"responses":{"400":{"description":"文件为空或读取失败","content":{"*/*":{"schema":{"$ref":"#/components/schemas/BaseResponseDocumentUploadResponse"}}}},"200":{"description":"上传成功","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DocumentUploadResponse"},"example":{"code":0,"data":{"documentId":1001,"filename":"demo.pdf","status":"UPLOADED","message":"文件上传成功，正在后台处理中"},"message":"ok"}}}}}}},"/user/list":{"get":{"tags":["用户管理"],"summary":"查询用户列表（管理员）","operationId":"listUser","parameters":[{"name":"request","in":"query","required":true,"schema":{"$ref":"#/components/schemas/UserQueryRequest"}}],"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/BaseResponseListUserVO"}}}}}}},"/user/get":{"get":{"tags":["用户管理"],"summary":"根据 id 获取用户（管理员）","operationId":"getUserById","parameters":[{"name":"id","in":"query","required":true,"schema":{"type":"integer","format":"int64"}}],"responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/BaseResponseUserVO"}}}}}}},"/user/current":{"get":{"tags":["用户管理"],"summary":"获取当前登录用户","operationId":"getCurrentUser","responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/BaseResponseUserVO"}}}}}}},"/tenant/list":{"get":{"tags":["团队管理"],"summary":"查询我加入的团队","operationId":"listMyTenants","responses":{"200":{"description":"OK","content":{"*/*":{"schema":{"$ref":"#/components/schemas/BaseResponseListTenantVO"}}}}}}},"/health":{"get":{"tags":["健康检查"],"summary":"健康检查","description":"用于探活或部署验证","operationId":"health","responses":{"200":{"description":"服务正常，返回 OK","content":{"text/plain":{"schema":{"type":"string"}}}}}}},"/api/document/{documentId}":{"get":{"tags":["文档管理"],"summary":"查询文档状态","description":"根据文档ID查询文档处理状态","operationId":"getDocument","parameters":[{"name":"documentId","in":"path","description":"文档唯一标识 ID","required":true,"schema":{"type":"integer","format":"int64"},"example":1001}],"responses":{"200":{"description":"文档详情","content":{"*/*":{"schema":{"$ref":"#/components/schemas/StudyFriendDocument"}}}}}},"delete":{"tags":["文档管理"],"summary":"删除文档","description":"删除文档及其关联的向量数据","operationId":"deleteDocument","parameters":[{"name":"documentId","in":"path","description":"文档唯一标识 ID","required":true,"schema":{"type":"integer","format":"int64"},"example":1001}],"responses":{"200":{"description":"删除成功","content":{"application/json":{"example":{"code":0,"data":"文档删除成功","message":"ok"}}}}}}},"/api/document/list":{"get":{"tags":["文档管理"],"summary":"查询所有文档","description":"获取所有文档列表及其状态","operationId":"listDocuments","responses":{"200":{"description":"文档列表","content":{"*/*":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/StudyFriendDocument"}}}}}}}},"/ai_friend/do_chat/sse_with_tool/emitter":{"get":{"tags":["学习伙伴聊天"],"summary":"SSE 流式聊天（可触发工具调用）","description":"与上一个接口一致，但内部可调用工具以获取外部数据，返回的流中同样包含文本增量。","operationId":"doChatWithRAGStreamTool","parameters":[{"name":"chatMessage","in":"query","description":"用户提问或对话内容","required":true,"schema":{"type":"string"},"example":"帮我查询最新的课程表"},{"name":"chatId","in":"query","description":"会话唯一标识，复用以保持上下文","required":true,"schema":{"type":"string"},"example":"session-001"}],"responses":{"200":{"description":"SSE 数据流（data 字段为字符串增量）","content":{"text/event-stream":{"example":"data: 我去调用工具查询...\\n\\n"}}}}}},"/ai_friend/do_chat/sse/emitter":{"get":{"tags":["学习伙伴聊天"],"summary":"SSE 流式聊天","description":"以 text/event-stream 返回增量输出，前端可直接用 EventSource 订阅。每条 data 为模型的部分回答。","operationId":"doChatWithRAGStream","parameters":[{"name":"chatMessage","in":"query","description":"用户提问或对话内容","required":true,"schema":{"type":"string"},"example":"请帮我总结这段话"},{"name":"chatId","in":"query","description":"会话唯一标识，复用以保持上下文","required":true,"schema":{"type":"string"},"example":"session-001"}],"responses":{"200":{"description":"SSE 数据流（data 字段为字符串增量）","content":{"text/event-stream":{"example":"data: 正在为你整理要点\\n\\n"}}}}}},"/ai_friend/do_chat/async":{"get":{"tags":["学习伙伴聊天"],"summary":"异步聊天（轮询获取完整回答）","description":"使用 chatId 维持上下文，会在服务端完成检索后返回一次性完整回答。","operationId":"doChatWithRAG","parameters":[{"name":"chatMessage","in":"query","description":"用户提问或对话内容","required":true,"schema":{"type":"string"},"example":"什么是向量数据库？"},{"name":"chatId","in":"query","description":"会话唯一标识，复用以保持上下文","required":true,"schema":{"type":"string"},"example":"session-001"}],"responses":{"200":{"description":"AI 的完整回答","content":{"text/plain":{"example":"向量数据库用于存储和检索高维向量，常用于相似度搜索。"}}}}}}},"components":{"schemas":{"UserUpdateRequest":{"type":"object","properties":{"id":{"type":"integer","description":"用户 id","format":"int64"},"userAccount":{"type":"string","description":"账号"},"userPassword":{"type":"string","description":"密码"},"userName":{"type":"string","description":"昵称"},"userAvatar":{"type":"string","description":"头像 URL"},"userProfile":{"type":"string","description":"用户简介"},"userRole":{"type":"string","description":"角色：user/admin/ban"},"unionId":{"type":"string","description":"微信开放平台 id"},"mpOpenId":{"type":"string","description":"公众号 openId"}},"description":"管理员更新用户请求"},"BaseResponseBoolean":{"type":"object","properties":{"code":{"type":"integer","description":"业务状态码，0 表示成功，其余表示失败","format":"int32","example":0},"data":{"type":"boolean","description":"真实业务数据载荷，可以是对象、列表或字符串"},"message":{"type":"string","description":"人类可读的补充信息，失败时包含错误原因","example":"ok"}},"description":"通用响应包装，所有接口保持相同结构"},"UserUpdateMyRequest":{"type":"object","properties":{"userName":{"type":"string","description":"昵称"},"userAvatar":{"type":"string","description":"头像 URL"},"userProfile":{"type":"string","description":"用户简介"}},"description":"更新个人信息请求"},"BaseResponseUserVO":{"type":"object","properties":{"code":{"type":"integer","description":"业务状态码，0 表示成功，其余表示失败","format":"int32","example":0},"data":{"$ref":"#/components/schemas/UserVO"},"message":{"type":"string","description":"人类可读的补充信息，失败时包含错误原因","example":"ok"}},"description":"通用响应包装，所有接口保持相同结构"},"UserVO":{"type":"object","properties":{"id":{"type":"integer","description":"用户 id","format":"int64"},"userAccount":{"type":"string","description":"账号"},"userName":{"type":"string","description":"昵称"},"userAvatar":{"type":"string","description":"头像 URL"},"userProfile":{"type":"string","description":"用户简介"},"userRole":{"type":"string","description":"角色"},"createTime":{"type":"string","description":"创建时间","format":"date-time"},"updateTime":{"type":"string","description":"更新时间","format":"date-time"}},"description":"用户信息"},"UserRegisterRequest":{"type":"object","properties":{"userAccount":{"type":"string","description":"账号"},"userPassword":{"type":"string","description":"密码"},"checkPassword":{"type":"string","description":"确认密码"},"userName":{"type":"string","description":"昵称"}},"description":"用户注册请求"},"BaseResponseLong":{"type":"object","properties":{"code":{"type":"integer","description":"业务状态码，0 表示成功，其余表示失败","format":"int32","example":0},"data":{"type":"integer","description":"真实业务数据载荷，可以是对象、列表或字符串","format":"int64"},"message":{"type":"string","description":"人类可读的补充信息，失败时包含错误原因","example":"ok"}},"description":"通用响应包装，所有接口保持相同结构"},"UserLoginRequest":{"type":"object","properties":{"userAccount":{"type":"string","description":"账号"},"userPassword":{"type":"string","description":"密码"}},"description":"用户登录请求"},"UserQueryRequest":{"type":"object","properties":{"current":{"type":"integer","format":"int32"},"pageSize":{"type":"integer","format":"int32"},"sortField":{"type":"string"},"sortOrder":{"type":"string"},"id":{"type":"integer","description":"用户 id","format":"int64"},"userAccount":{"type":"string","description":"账号"},"userName":{"type":"string","description":"昵称"},"userRole":{"type":"string","description":"角色"}},"description":"用户查询请求"},"BaseResponsePageUserVO":{"type":"object","properties":{"code":{"type":"integer","description":"业务状态码，0 表示成功，其余表示失败","format":"int32","example":0},"data":{"$ref":"#/components/schemas/PageUserVO"},"message":{"type":"string","description":"人类可读的补充信息，失败时包含错误原因","example":"ok"}},"description":"通用响应包装，所有接口保持相同结构"},"PageUserVO":{"type":"object","properties":{"totalElements":{"type":"integer","format":"int64"},"totalPages":{"type":"integer","format":"int32"},"size":{"type":"integer","format":"int32"},"content":{"type":"array","items":{"$ref":"#/components/schemas/UserVO"}},"number":{"type":"integer","format":"int32"},"sort":{"$ref":"#/components/schemas/SortObject"},"first":{"type":"boolean"},"last":{"type":"boolean"},"numberOfElements":{"type":"integer","format":"int32"},"pageable":{"$ref":"#/components/schemas/PageableObject"},"empty":{"type":"boolean"}},"description":"真实业务数据载荷，可以是对象、列表或字符串"},"PageableObject":{"type":"object","properties":{"offset":{"type":"integer","format":"int64"},"sort":{"$ref":"#/components/schemas/SortObject"},"paged":{"type":"boolean"},"unpaged":{"type":"boolean"},"pageNumber":{"type":"integer","format":"int32"},"pageSize":{"type":"integer","format":"int32"}}},"SortObject":{"type":"object","properties":{"empty":{"type":"boolean"},"sorted":{"type":"boolean"},"unsorted":{"type":"boolean"}}},"DeleteRequest":{"type":"object","properties":{"id":{"type":"integer","format":"int64"}}},"UserCreateRequest":{"type":"object","properties":{"userAccount":{"type":"string","description":"账号"},"userPassword":{"type":"string","description":"密码"},"userName":{"type":"string","description":"昵称"},"userAvatar":{"type":"string","description":"头像 URL"},"userProfile":{"type":"string","description":"用户简介"},"userRole":{"type":"string","description":"角色：user/admin/ban"},"unionId":{"type":"string","description":"微信开放平台 id"},"mpOpenId":{"type":"string","description":"公众号 openId"}},"description":"管理员创建用户请求"},"TenantTransferAdminRequest":{"required":["newAdminUserId","tenantId"],"type":"object","properties":{"tenantId":{"type":"integer","description":"团队 ID","format":"int64","example":1001},"newAdminUserId":{"type":"integer","description":"新的管理员用户 ID","format":"int64","example":2002}},"description":"管理员转让请求"},"TenantLeaveRequest":{"required":["tenantId"],"type":"object","properties":{"tenantId":{"type":"integer","description":"团队 ID","format":"int64","example":1001}},"description":"退出团队请求"},"TenantJoinRequest":{"required":["tenantId"],"type":"object","properties":{"tenantId":{"type":"integer","description":"团队 ID","format":"int64","example":1001}},"description":"加入团队请求"},"TenantCreateRequest":{"required":["tenantName"],"type":"object","properties":{"tenantName":{"type":"string","description":"团队名称"}},"description":"创建团队请求"},"BaseResponseTenantVO":{"type":"object","properties":{"code":{"type":"integer","description":"业务状态码，0 表示成功，其余表示失败","format":"int32","example":0},"data":{"$ref":"#/components/schemas/TenantVO"},"message":{"type":"string","description":"人类可读的补充信息，失败时包含错误原因","example":"ok"}},"description":"通用响应包装，所有接口保持相同结构"},"TenantVO":{"type":"object","properties":{"id":{"type":"integer","description":"团队 ID","format":"int64","example":1001},"tenantName":{"type":"string","description":"团队名称"},"tenantType":{"type":"string","description":"团队类型：personal/team"},"ownerUserId":{"type":"integer","description":"团队管理员用户 ID","format":"int64"},"role":{"type":"string","description":"当前用户在团队中的角色：admin/member"},"createTime":{"type":"string","description":"创建时间","format":"date-time"},"updateTime":{"type":"string","description":"更新时间","format":"date-time"}},"description":"团队信息"},"TenantSetActiveRequest":{"required":["tenantId"],"type":"object","properties":{"tenantId":{"type":"integer","description":"团队 ID","format":"int64","example":1001}},"description":"切换当前团队请求"},"DocumentUploadResponse":{"type":"object","properties":{"documentId":{"type":"integer","description":"文档唯一标识 ID","format":"int64","example":1024},"filename":{"type":"string","description":"上传时的原始文件名","example":"course-notes.pdf"},"status":{"type":"string","description":"文档当前处理状态","example":"UPLOADED"},"message":{"type":"string","description":"给前端的提示信息","example":"文件上传成功，正在后台处理中"}},"description":"文档上传成功后的返回内容"},"BaseResponseDocumentUploadResponse":{"type":"object","properties":{"code":{"type":"integer","description":"业务状态码，0 表示成功，其余表示失败","format":"int32","example":0},"data":{"$ref":"#/components/schemas/DocumentUploadResponse"},"message":{"type":"string","description":"人类可读的补充信息，失败时包含错误原因","example":"ok"}},"description":"通用响应包装，所有接口保持相同结构"},"BaseResponseListUserVO":{"type":"object","properties":{"code":{"type":"integer","description":"业务状态码，0 表示成功，其余表示失败","format":"int32","example":0},"data":{"type":"array","description":"真实业务数据载荷，可以是对象、列表或字符串","items":{"$ref":"#/components/schemas/UserVO"}},"message":{"type":"string","description":"人类可读的补充信息，失败时包含错误原因","example":"ok"}},"description":"通用响应包装，所有接口保持相同结构"},"BaseResponseListTenantVO":{"type":"object","properties":{"code":{"type":"integer","description":"业务状态码，0 表示成功，其余表示失败","format":"int32","example":0},"data":{"type":"array","description":"真实业务数据载荷，可以是对象、列表或字符串","items":{"$ref":"#/components/schemas/TenantVO"}},"message":{"type":"string","description":"人类可读的补充信息，失败时包含错误原因","example":"ok"}},"description":"通用响应包装，所有接口保持相同结构"},"StudyFriendDocument":{"type":"object","properties":{"id":{"type":"integer","description":"主键 ID","format":"int64","example":1},"tenantId":{"type":"integer","description":"租户 ID","format":"int64","example":100},"ownerUserId":{"type":"integer","description":"归属用户 ID","format":"int64","example":1},"fileName":{"type":"string","description":"文件名","example":"demo.pdf"},"filePath":{"type":"string","description":"文件存储路径（相对路径）","example":"/upload_file/demo.pdf"},"fileType":{"type":"string","description":"文件类型 (pdf/pptx/docx/image/md)","example":"pdf"},"status":{"type":"string","description":"文档处理状态","example":"INDEXED","enum":["UPLOADED","INDEXING","INDEXED","FAILED"]},"errorMessage":{"type":"string","description":"失败原因，仅在处理失败时返回","example":"解析失败：不支持的格式"},"createdAt":{"type":"string","description":"创建时间","format":"date-time"},"updatedAt":{"type":"string","description":"更新时间","format":"date-time"}},"description":"学习助手文档信息"}}}}