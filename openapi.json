{"openapi":"3.0.1","info":{"title":"OpenAPI definition","version":"v0"},"servers":[{"url":"http://localhost:8525/api","description":"Generated server url"}],"tags":[{"name":"文档管理","description":"文档上传与索引管理接口"},{"name":"学习伙伴聊天","description":"基于向量检索的 AI 学习助手对话接口（支持轮询与 SSE）"},{"name":"健康检查","description":"基础探活接口"}],"paths":{"/api/document/{documentId}/reindex":{"post":{"tags":["文档管理"],"summary":"重新索引文档","description":"重新执行文档的向量化处理（用于失败重试）","operationId":"reindexDocument","parameters":[{"name":"documentId","in":"path","description":"文档唯一标识 ID","required":true,"schema":{"type":"integer","format":"int64"},"example":1001}],"responses":{"200":{"description":"提交成功","content":{"application/json":{"example":{"code":0,"data":"重新索引任务已提交","message":"ok"}}}}}}},"/api/document/upload":{"post":{"tags":["文档管理"],"summary":"上传文档","description":"上传文档后立即返回，后台异步进行向量化处理。返回的 documentId 可用于查询状态。","operationId":"uploadDocument","requestBody":{"content":{"multipart/form-data":{"schema":{"required":["file"],"type":"object","properties":{"file":{"type":"string","description":"上传的文档文件，支持 pdf/pptx/docx/md 等","format":"binary"}}}}}},"responses":{"200":{"description":"上传成功","content":{"application/json":{"schema":{"$ref":"#/components/schemas/DocumentUploadResponse"},"example":{"code":0,"data":{"documentId":1001,"filename":"demo.pdf","status":"UPLOADED","message":"文件上传成功，正在后台处理中"},"message":"ok"}}}},"400":{"description":"文件为空或读取失败","content":{"*/*":{"schema":{"$ref":"#/components/schemas/BaseResponseDocumentUploadResponse"}}}}}}},"/health":{"get":{"tags":["健康检查"],"summary":"健康检查","description":"用于探活或部署验证","operationId":"health","responses":{"200":{"description":"服务正常，返回 OK","content":{"text/plain":{"schema":{"type":"string"}}}}}}},"/api/document/{documentId}":{"get":{"tags":["文档管理"],"summary":"查询文档状态","description":"根据文档ID查询文档处理状态","operationId":"getDocument","parameters":[{"name":"documentId","in":"path","description":"文档唯一标识 ID","required":true,"schema":{"type":"integer","format":"int64"},"example":1001}],"responses":{"200":{"description":"文档详情","content":{"*/*":{"schema":{"$ref":"#/components/schemas/StudyFriendDocument"}}}}}},"delete":{"tags":["文档管理"],"summary":"删除文档","description":"删除文档及其关联的向量数据","operationId":"deleteDocument","parameters":[{"name":"documentId","in":"path","description":"文档唯一标识 ID","required":true,"schema":{"type":"integer","format":"int64"},"example":1001}],"responses":{"200":{"description":"删除成功","content":{"application/json":{"example":{"code":0,"data":"文档删除成功","message":"ok"}}}}}}},"/api/document/list":{"get":{"tags":["文档管理"],"summary":"查询所有文档","description":"获取所有文档列表及其状态","operationId":"listDocuments","responses":{"200":{"description":"文档列表","content":{"*/*":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/StudyFriendDocument"}}}}}}}},"/ai_friend/do_chat/sse_with_tool/emitter":{"get":{"tags":["学习伙伴聊天"],"summary":"SSE 流式聊天（可触发工具调用）","description":"与上一个接口一致，但内部可调用工具以获取外部数据，返回的流中同样包含文本增量。","operationId":"doChatWithRAGStreamTool","parameters":[{"name":"chatMessage","in":"query","description":"用户提问或对话内容","required":true,"schema":{"type":"string"},"example":"帮我查询最新的课程表"},{"name":"chatId","in":"query","description":"会话唯一标识，复用以保持上下文","required":true,"schema":{"type":"string"},"example":"session-001"}],"responses":{"200":{"description":"SSE 数据流（data 字段为字符串增量）","content":{"text/event-stream":{"example":"data: 我去调用工具查询...\\n\\n"}}}}}},"/ai_friend/do_chat/sse/emitter":{"get":{"tags":["学习伙伴聊天"],"summary":"SSE 流式聊天","description":"以 text/event-stream 返回增量输出，前端可直接用 EventSource 订阅。每条 data 为模型的部分回答。","operationId":"doChatWithRAGStream","parameters":[{"name":"chatMessage","in":"query","description":"用户提问或对话内容","required":true,"schema":{"type":"string"},"example":"请帮我总结这段话"},{"name":"chatId","in":"query","description":"会话唯一标识，复用以保持上下文","required":true,"schema":{"type":"string"},"example":"session-001"}],"responses":{"200":{"description":"SSE 数据流（data 字段为字符串增量）","content":{"text/event-stream":{"example":"data: 正在为你整理要点\\n\\n"}}}}}},"/ai_friend/do_chat/async":{"get":{"tags":["学习伙伴聊天"],"summary":"异步聊天（轮询获取完整回答）","description":"使用 chatId 维持上下文，会在服务端完成检索后返回一次性完整回答。","operationId":"doChatWithRAG","parameters":[{"name":"chatMessage","in":"query","description":"用户提问或对话内容","required":true,"schema":{"type":"string"},"example":"什么是向量数据库？"},{"name":"chatId","in":"query","description":"会话唯一标识，复用以保持上下文","required":true,"schema":{"type":"string"},"example":"session-001"}],"responses":{"200":{"description":"AI 的完整回答","content":{"text/plain":{"example":"向量数据库用于存储和检索高维向量，常用于相似度搜索。"}}}}}}},"components":{"schemas":{"DocumentUploadResponse":{"type":"object","properties":{"documentId":{"type":"integer","description":"文档唯一标识 ID","format":"int64","example":1024},"filename":{"type":"string","description":"上传时的原始文件名","example":"course-notes.pdf"},"status":{"type":"string","description":"文档当前处理状态","example":"UPLOADED"},"message":{"type":"string","description":"给前端的提示信息","example":"文件上传成功，正在后台处理中"}},"description":"文档上传成功后的返回内容"},"BaseResponseDocumentUploadResponse":{"type":"object","properties":{"code":{"type":"integer","description":"业务状态码，0 表示成功，其余表示失败","format":"int32","example":0},"data":{"$ref":"#/components/schemas/DocumentUploadResponse"},"message":{"type":"string","description":"人类可读的补充信息，失败时包含错误原因","example":"ok"}},"description":"通用响应包装，所有接口保持相同结构"},"StudyFriendDocument":{"type":"object","properties":{"id":{"type":"integer","description":"主键 ID","format":"int64","example":1},"fileName":{"type":"string","description":"文件名","example":"demo.pdf"},"filePath":{"type":"string","description":"文件存储路径（相对路径）","example":"/upload_file/demo.pdf"},"fileType":{"type":"string","description":"文件类型 (pdf/pptx/docx/image/md)","example":"pdf"},"status":{"type":"string","description":"文档处理状态","example":"INDEXED","enum":["UPLOADED","INDEXING","INDEXED","FAILED"]},"errorMessage":{"type":"string","description":"失败原因，仅在处理失败时返回","example":"解析失败：不支持的格式"},"createdAt":{"type":"string","description":"创建时间","format":"date-time"},"updatedAt":{"type":"string","description":"更新时间","format":"date-time"}},"description":"学习助手文档信息"}}}}